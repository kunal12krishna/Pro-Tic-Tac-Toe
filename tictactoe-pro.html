<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Tic Tac Toe</title>
    <style>
        :root {
            --x: #00f3ff;
            --o: #ff00ff;
            --accent: #9d00ff;
            --bg: #0a0a0a;
            --card: #1a1a1a;
            --border: #333;
        }
        [data-theme="cyber"] {
            --x: #ff0080;
            --o: #00ff9f;
            --accent: #ffff00;
            --bg: #0d0221;
            --card: #240046;
            --border: #7209b7;
        }
        [data-theme="minimal"] {
            --x: #4a9eff;
            --o: #ff6b6b;
            --accent: #51cf66;
            --bg: #1a1a2e;
            --card: #16213e;
            --border: #0f3460;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: linear-gradient(45deg, var(--bg), var(--card), var(--bg));
            background-size: 400% 400%;
            animation: shift 15s ease infinite;
            z-index: -1;
        }
        @keyframes shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .particles { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--x);
            border-radius: 50%;
            animation: float 10s infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); opacity: 0; }
            10%, 90% { opacity: 0.5; }
            100% { transform: translateY(-100vh); }
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
        h1 {
            text-align: center;
            font-size: clamp(2em, 5vw, 3em);
            background: linear-gradient(90deg, var(--x), var(--o), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 3s ease-in-out infinite;
        }
        @keyframes glow { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.5); } }
        .themes {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: 0.3s;
        }
        .theme-btn.active { border-color: var(--accent); box-shadow: 0 0 15px var(--accent); }
        .theme-btn:hover { transform: scale(1.1); }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        .control {
            background: var(--card);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
            min-width: 200px;
        }
        .control label {
            display: block;
            color: var(--accent);
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        select, button {
            width: 100%;
            background: var(--card);
            color: white;
            border: 1px solid var(--accent);
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: 0.3s;
        }
        select:hover, select:focus { border-color: var(--x); box-shadow: 0 0 10px var(--x); outline: none; }
        button { font-weight: bold; text-transform: uppercase; }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 0 20px var(--accent); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: linear-gradient(135deg, var(--x), var(--o)); border: none; }
        .layout { display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 20px; margin: 30px 0; }
        @media (max-width: 1200px) { .layout { grid-template-columns: 1fr; } }
        .panel {
            background: var(--card);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--border);
        }
        .panel h2 { color: var(--accent); margin-bottom: 15px; font-size: 1.2em; }
        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: 0.3s;
        }
        .score-item.active {
            border: 2px solid var(--accent);
            transform: scale(1.05);
            animation: pulse 0.5s;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1.05); } 50% { transform: scale(1.1); } }
        .score-value { font-size: 1.8em; font-weight: bold; }
        .score-value.update { animation: scaleUp 0.5s; }
        @keyframes scaleUp { 50% { transform: scale(1.5); } }
        .center { display: flex; flex-direction: column; align-items: center; }
        .board {
            display: grid;
            gap: 8px;
            margin: 20px;
        }
        .board.s3 { grid-template-columns: repeat(3, 100px); }
        .board.s4 { grid-template-columns: repeat(4, 85px); }
        .board.s5 { grid-template-columns: repeat(5, 70px); }
        @media (max-width: 600px) {
            .board.s3 { grid-template-columns: repeat(3, 80px); }
            .board.s4 { grid-template-columns: repeat(4, 65px); }
            .board.s5 { grid-template-columns: repeat(5, 55px); }
        }
        .cell {
            aspect-ratio: 1;
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 2.5em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            position: relative;
        }
        .cell:hover:not(.taken):not(.off) {
            border-color: var(--accent);
            box-shadow: 0 0 20px var(--accent);
            transform: scale(1.05);
        }
        .cell:focus { outline: 2px solid var(--accent); outline-offset: 2px; }
        .cell.taken { cursor: not-allowed; }
        .cell.off { opacity: 0.5; cursor: not-allowed; }
        .cell.x { color: var(--x); text-shadow: 0 0 20px var(--x); animation: place 0.5s; }
        .cell.o { color: var(--o); text-shadow: 0 0 20px var(--o); animation: place 0.5s; }
        @keyframes place { from { transform: scale(0) rotate(180deg); opacity: 0; } }
        .cell.win { animation: winner 1s infinite; }
        @keyframes winner {
            0%, 100% { box-shadow: 0 0 20px var(--x); transform: scale(1); }
            50% { box-shadow: 0 0 40px var(--o); transform: scale(1.1); }
        }
        .msg {
            min-height: 50px;
            margin: 20px 0;
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transition: 0.3s;
        }
        .msg.show { opacity: 1; transform: translateY(0); }
        .msg.winner {
            background: linear-gradient(90deg, var(--x), var(--o));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 1s infinite;
        }
        .msg.draw { color: var(--accent); text-shadow: 0 0 20px var(--accent); }
        .actions { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        .actions button { min-width: 100px; }
        .history { max-height: 600px; overflow-y: auto; }
        .history::-webkit-scrollbar { width: 8px; }
        .history::-webkit-scrollbar-track { background: var(--bg); border-radius: 4px; }
        .history::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }
        .move {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            justify-content: space-between;
        }
        .move:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); }
        .move.x { border-left: 3px solid var(--x); }
        .move.o { border-left: 3px solid var(--o); }
        .think { text-align: center; color: var(--accent); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body data-theme="neon">
    <div class="particles" id="part"></div>
    <div class="themes">
        <button class="theme-btn active" data-theme="neon" style="background:linear-gradient(135deg,#00f3ff,#ff00ff)" title="Neon"></button>
        <button class="theme-btn" data-theme="cyber" style="background:linear-gradient(135deg,#ff0080,#00ff9f)" title="Cyber"></button>
        <button class="theme-btn" data-theme="minimal" style="background:linear-gradient(135deg,#4a9eff,#ff6b6b)" title="Minimal"></button>
    </div>
    <div class="container">
        <h1>âš¡ TIC TAC TOE PRO âš¡</h1>
        <div class="controls">
            <div class="control">
                <label>Board Size</label>
                <select id="size"><option value="3">3x3</option><option value="4">4x4</option><option value="5">5x5</option></select>
            </div>
            <div class="control">
                <label>Mode</label>
                <select id="mode"><option value="pvp">Player vs Player</option><option value="ai">Player vs AI</option></select>
            </div>
            <div class="control" id="diffGrp" style="display:none">
                <label>AI Level</label>
                <select id="diff"><option value="easy">Easy</option><option value="med">Medium</option><option value="hard">Impossible</option></select>
            </div>
            <div class="control"><button class="btn-primary" id="new">New Game</button></div>
        </div>
        <div class="layout">
            <aside class="panel">
                <h2>ðŸ“Š Score</h2>
                <div class="score-item active" id="sx">
                    <div><div style="color:var(--x);font-weight:bold">PLAYER X</div><small id="xt">Human</small></div>
                    <div class="score-value" id="xv">0</div>
                </div>
                <div class="score-item" id="so">
                    <div><div style="color:var(--o);font-weight:bold">PLAYER O</div><small id="ot">Human</small></div>
                    <div class="score-value" id="ov">0</div>
                </div>
            </aside>
            <main class="center">
                <div id="board" class="board s3"></div>
                <div class="msg" id="msg"></div>
                <div class="think" id="think" style="display:none">AI thinking...</div>
                <div class="actions">
                    <button id="undo" disabled>â†¶ Undo</button>
                    <button id="redo" disabled>â†· Redo</button>
                    <button id="reset" class="btn-primary">ðŸ”„ Reset</button>
                </div>
            </main>
            <aside class="panel history">
                <h2>ðŸ“œ History</h2>
                <div id="hist"></div>
            </aside>
        </div>
    </div>
    <script>
        // State
        const st = {
            board: [],
            size: 3,
            curr: 'X',
            active: true,
            mode: 'pvp',
            diff: 'hard',
            scores: {X:0, O:0},
            hist: [],
            redo: [],
            focus: 0
        };
        
        // Elements
        const el = {
            board: document.getElementById('board'),
            msg: document.getElementById('msg'),
            think: document.getElementById('think'),
            sx: document.getElementById('sx'),
            so: document.getElementById('so'),
            xv: document.getElementById('xv'),
            ov: document.getElementById('ov'),
            xt: document.getElementById('xt'),
            ot: document.getElementById('ot'),
            hist: document.getElementById('hist'),
            size: document.getElementById('size'),
            mode: document.getElementById('mode'),
            diff: document.getElementById('diff'),
            diffGrp: document.getElementById('diffGrp'),
            new: document.getElementById('new'),
            reset: document.getElementById('reset'),
            undo: document.getElementById('undo'),
            redo: document.getElementById('redo')
        };
        
        // Particles
        for(let i=0;i<30;i++){
            const p=document.createElement('div');
            p.className='particle';
            p.style.left=Math.random()*100+'%';
            p.style.animationDelay=Math.random()*10+'s';
            document.getElementById('part').appendChild(p);
        }
        
        // Theme
        document.querySelectorAll('.theme-btn').forEach(b=>{
            b.onclick=()=>{
                document.querySelectorAll('.theme-btn').forEach(x=>x.classList.remove('active'));
                b.classList.add('active');
                document.body.dataset.theme=b.dataset.theme;
                save();
            };
        });
        
        // Init
        function init(){
            st.board=Array(st.size*st.size).fill('');
            el.board.innerHTML='';
            el.board.className=`board s${st.size}`;
            for(let i=0;i<st.size*st.size;i++){
                const c=document.createElement('div');
                c.className='cell';
                c.dataset.i=i;
                c.tabIndex=0;
                c.onclick=()=>move(i);
                c.onkeydown=e=>{if(e.key==='Enter'||e.key===' ')move(i);};
                el.board.appendChild(c);
            }
        }
        
        // Move
        function move(i){
            if(!st.active||st.board[i]||el.think.style.display==='block')return;
            st.board[i]=st.curr;
            st.hist.push({i,p:st.curr});
            st.redo=[];
            render();
            sound();
            if(checkWin()){
                win();
                return;
            }
            if(st.board.every(c=>c)){
                draw();
                return;
            }
            st.curr=st.curr==='X'?'O':'X';
            updateActive();
            if(st.mode==='ai'&&st.curr==='O'){
                setTimeout(aiMove,500);
            }
        }
        
        // AI
        function aiMove(){
            el.think.style.display='block';
            el.board.querySelectorAll('.cell').forEach(c=>c.classList.add('off'));
            setTimeout(()=>{
                let i;
                if(st.diff==='easy'){
                    const empty=st.board.map((v,i)=>v===''?i:-1).filter(x=>x>=0);
                    i=empty[Math.floor(Math.random()*empty.length)];
                }else if(st.diff==='med'){
                    i=Math.random()<0.5?minimax().i:st.board.map((v,i)=>v===''?i:-1).filter(x=>x>=0)[0];
                }else{
                    i=minimax().i;
                }
                el.think.style.display='none';
                el.board.querySelectorAll('.cell').forEach(c=>c.classList.remove('off'));
                if(i!==undefined)move(i);
            },800);
        }
        
        // Minimax
        function minimax(depth=0,isMax=true){
            const w=checkWin();
            if(w){
                const winner=st.board[w[0]];
                return{score:winner==='O'?10-depth:-10+depth};
            }
            if(st.board.every(c=>c))return{score:0};
            const moves=[];
            const empty=st.board.map((v,i)=>v===''?i:-1).filter(x=>x>=0);
            for(const i of empty){
                st.board[i]=isMax?'O':'X';
                const score=minimax(depth+1,!isMax).score;
                st.board[i]='';
                moves.push({i,score});
            }
            return isMax?moves.reduce((a,b)=>a.score>b.score?a:b):moves.reduce((a,b)=>a.score<b.score?a:b);
        }
        
        // Check Win
        function checkWin(){
            const patterns=[];
            const s=st.size;
            // Rows
            for(let r=0;r<s;r++){
                const row=[];
                for(let c=0;c<s;c++)row.push(r*s+c);
                patterns.push(row);
            }
            // Cols
            for(let c=0;c<s;c++){
                const col=[];
                for(let r=0;r<s;r++)col.push(r*s+c);
                patterns.push(col);
            }
            // Diagonals
            const d1=[],d2=[];
            for(let i=0;i<s;i++){
                d1.push(i*s+i);
                d2.push(i*s+(s-1-i));
            }
            patterns.push(d1,d2);
            
            for(const p of patterns){
                if(st.board[p[0]]&&p.every(i=>st.board[i]===st.board[p[0]]))return p;
            }
            return null;
        }
        
        // Win
        function win(){
            st.active=false;
            const w=checkWin();
            w.forEach(i=>el.board.children[i].classList.add('win'));
            st.scores[st.curr]++;
            updateScore();
            el.msg.textContent=`ðŸŽ‰ Player ${st.curr} Wins! ðŸŽ‰`;
            el.msg.className='msg winner show';
            sound(true);
            el.sx.classList.remove('active');
            el.so.classList.remove('active');
            confetti();
            save();
        }
        
        // Draw
        function draw(){
            st.active=false;
            el.msg.textContent='ðŸ¤ Draw! ðŸ¤';
            el.msg.className='msg draw show';
            el.sx.classList.remove('active');
            el.so.classList.remove('active');
        }
        
        // Undo
        el.undo.onclick=()=>{
            if(!st.hist.length)return;
            const m=st.hist.pop();
            st.redo.push(m);
            st.board[m.i]='';
            st.curr=m.p;
            st.active=true;
            el.msg.className='msg';
            render();
            updateActive();
        };
        
        // Redo
        el.redo.onclick=()=>{
            if(!st.redo.length)return;
            const m=st.redo.pop();
            st.board[m.i]=m.p;
            st.hist.push(m);
            render();
            sound();
            if(checkWin()){
                win();
                return;
            }
            if(st.board.every(c=>c)){
                draw();
                return;
            }
            st.curr=st.curr==='X'?'O':'X';
            updateActive();
        };
        
        // Render
        function render(){
            el.board.querySelectorAll('.cell').forEach((c,i)=>{
                c.textContent=st.board[i];
                c.className='cell';
                if(st.board[i]){
                    c.classList.add(st.board[i].toLowerCase(),'taken');
                }
            });
            el.undo.disabled=!st.hist.length;
            el.redo.disabled=!st.redo.length;
            updateHist();
        }
        
        // History
        function updateHist(){
            el.hist.innerHTML='';
            st.hist.forEach((m,i)=>{
                const d=document.createElement('div');
                d.className=`move ${m.p.toLowerCase()}`;
                d.innerHTML=`<span>Move ${i+1}: ${m.p}</span><span>Cell ${m.i+1}</span>`;
                d.onmouseover=()=>el.board.children[m.i].classList.add('highlight');
                d.onmouseout=()=>el.board.children[m.i].classList.remove('highlight');
                el.hist.appendChild(d);
            });
        }
        
        // Active
        function updateActive(){
            if(st.curr==='X'){
                el.sx.classList.add('active');
                el.so.classList.remove('active');
            }else{
                el.sx.classList.remove('active');
                el.so.classList.add('active');
            }
        }
        
        // Score
        function updateScore(){
            el.xv.textContent=st.scores.X;
            el.ov.textContent=st.scores.O;
            (st.curr==='X'?el.xv:el.ov).classList.add('update');
            setTimeout(()=>{
                el.xv.classList.remove('update');
                el.ov.classList.remove('update');
            },500);
        }
        
        // Sound
        function sound(win=false){
            try{
                const ctx=new AudioContext();
                const osc=ctx.createOscillator();
                const gain=ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value=win?1200:800;
                gain.gain.setValueAtTime(0.3,ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+(win?0.3:0.1));
                osc.start();
                osc.stop(ctx.currentTime+(win?0.3:0.1));
            }catch(e){}
        }
        
        // Confetti
        function confetti(){
            const c=document.createElement('div');
            c.style='position:fixed;inset:0;pointer-events:none;z-index:9999';
            document.body.appendChild(c);
            for(let i=0;i<50;i++){
                const p=document.createElement('div');
                p.style=`position:absolute;left:${Math.random()*100}%;top:-20px;width:10px;height:10px;background:${['var(--x)','var(--o)','var(--accent)'][i%3]};animation:fall ${2+Math.random()}s ease-out forwards`;
                c.appendChild(p);
            }
            setTimeout(()=>c.remove(),3000);
        }
        const s=document.createElement('style');
        s.textContent='@keyframes fall{to{transform:translateY(100vh) rotate(720deg);opacity:0}}';
        document.head.appendChild(s);
        
        // Storage
        function save(){
            localStorage.setItem('ttt',JSON.stringify({
                size:st.size,
                mode:st.mode,
                diff:st.diff,
                scores:st.scores,
                theme:document.body.dataset.theme
            }));
        }
        
        function load(){
            try{
                const d=JSON.parse(localStorage.getItem('ttt'));
                if(d){
                    st.size=d.size||3;
                    st.mode=d.mode||'pvp';
                    st.diff=d.diff||'hard';
                    st.scores=d.scores||{X:0,O:0};
                    el.size.value=st.size;
                    el.mode.value=st.mode;
                    el.diff.value=st.diff;
                    if(d.theme){
                        document.body.dataset.theme=d.theme;
                        document.querySelectorAll('.theme-btn').forEach(b=>{
                            b.classList.toggle('active',b.dataset.theme===d.theme);
                        });
                    }
                    updateScore();
                    updateTypes();
                }
            }catch(e){}
        }
        
        // Types
        function updateTypes(){
            el.diffGrp.style.display=st.mode==='ai'?'block':'none';
            el.xt.textContent='Human';
            el.ot.textContent=st.mode==='ai'?`AI (${st.diff})`.toUpperCase():'Human';
        }
        
        // Controls
        el.size.onchange=()=>{st.size=+el.size.value;startNew();};
        el.mode.onchange=()=>{st.mode=el.mode.value;updateTypes();startNew();save();};
        el.diff.onchange=()=>{st.diff=el.diff.value;updateTypes();save();};
        el.new.onclick=startNew;
        el.reset.onclick=()=>{
            st.curr='X';
            st.active=true;
            st.hist=[];
            st.redo=[];
            el.msg.className='msg';
            init();
            updateActive();
        };
        
        function startNew(){
            st.curr='X';
            st.active=true;
            st.hist=[];
            st.redo=[];
            el.msg.className='msg';
            init();
            updateActive();
            save();
        }
        
        // Keyboard
        document.addEventListener('keydown',e=>{
            if(!st.active)return;
            const cells=el.board.querySelectorAll('.cell');
            if(e.key==='ArrowRight')st.focus=Math.min(st.focus+1,cells.length-1);
            if(e.key==='ArrowLeft')st.focus=Math.max(st.focus-1,0);
            if(e.key==='ArrowDown')st.focus=Math.min(st.focus+st.size,cells.length-1);
            if(e.key==='ArrowUp')st.focus=Math.max(st.focus-st.size,0);
            cells[st.focus].focus();
        });
        
        // Start
        load();
        init();
        updateActive();
        updateTypes();
    </script>
</body>
</html>
